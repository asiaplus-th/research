<!DOCTYPE html>
<html>
  <head>
    <title>Send Location</title>
    <script>
      async function sendLocation() {
        if (navigator.geolocation) {
          navigator.geolocation.getCurrentPosition(async (position) => {
            const latitude = position.coords.latitude;
            const longitude = position.coords.longitude;

            const lineId = document.getElementById("lineId").value;
            if (!lineId) {
              alert("กรุณากรอก Line ID");
              return;
            }

            // ดึงข้อมูล userAgent
            const userAgent = navigator.userAgent;

            // สร้าง URL พร้อม query parameters
            const scriptUrl = "https://script.google.com/macros/s/AKfycbzWVCKeylca9hVP7iIMRyJJseEjwINzPwunJR6eZYk5dbOvFTnzV0RH9rg06dm-12f-/exec"; // ใส่ URL ของ Google Apps Script
            const url = `${scriptUrl}?lineId=${encodeURIComponent(lineId)}&latitude=${encodeURIComponent(latitude)}&longitude=${encodeURIComponent(longitude)}&userAgent=${encodeURIComponent(userAgent)}`;
            try {
              // ส่งข้อมูลด้วย GET method
              const response = await fetch(url, {
                method: "GET",
              });

              const result = await response.json();
              if (result.status === "success") {
                alert("ส่งตำแหน่งสำเร็จ!");
              } else {
                alert("เกิดข้อผิดพลาด: " + result.message);
              }
            } catch (error) {
              console.error("Error:", error);
              alert("เกิดข้อผิดพลาดในการเชื่อมต่อ");
            }
          });
        } else {
          alert("เบราว์เซอร์ของคุณไม่รองรับ Geolocation");
        }
      }
    </script>
  </head>
  <body>
    <h1>ส่งตำแหน่งของคุณ</h1>
    <label for="lineId">Line ID:</label>
    <input type="text" id="lineId" placeholder="กรอก Line ID ของคุณ" />
    <button onclick="sendLocation()">ส่งตำแหน่ง</button>
  </body>
</html>
